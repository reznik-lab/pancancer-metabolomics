# pancancer-metabolomics

This repository contains the code to reproduce the findings and figures presented in Benedetti, Liu, Tang, et al., _A Multimodal Atlas of Tumor Metabolism Reveals the Architecture of Gene-Metabolite Co-regulation_, bioRxiv (2022) [url link].

## Data

Before running the code, data must be downloaded from Zenodo (DOI: 10.5281/zenodo.7343440) [url link] and the unzipped folder should be copied into the cloned repository main folder.
The data structure is as follows:

* "_metabolomics_original_" contains the unprocessed metabolomics data
* "_metabolomics_processed_" contains the preprocessed metabolomics data
* "_RNA_processed_" contains the preprocessed transcriptomics data
* "_TME_deconvolution_processed_" contains the immune deconvolution data

## Code

### Data Preprocessing

The preprocessed data can be generated by running the following scripts, in order:

* **_1_PreprocessedMetabo.R_**
* **_2_ImputeMetabo.R_**
* **_3_FilterMetabo.R_**
* **_4_FilterRNA.R_**
 
The preprocessed data will be generated and stored in the "_data/preprocessed/_" folder.

### Data Analysis

In order to generate the main results presented in the paper, please run the follwing scripts.

#### Concordance Meta-Analysis

The concordance meta-analysis results can be reproduced by running the following scripts, in order:

* **_5_ConcordanceMetaAnalysis.R_**
* **_6_ConcordancePathwayEnrichmentAnalysis.R_**

Please note that script number 5 requires the output of scripts 1-4. Moreover, this script will take a long time to run on a regular laptop with 4 cores (>12h). For this reason, we also provide a precalculated version of the output (_precalculated_results_/ConcordanceMetaAnalysis_precalculated.txt) that will be used to generate the paper figures in absence of the script output.

#### Tumor Versus Normal Analysis

* **_7_TumorVsNormalAnalysis.R_**

#### Immune Score Analysis

* **_8_ImmuneAnalysis.R_**

### Figures

In order to reproduce the paper figures, please run the following scripts, in order:

* **_9_Figure1-2-4.R_**
* **_10_Figure3.R_**
* **_11_Figure5-6.R_**

